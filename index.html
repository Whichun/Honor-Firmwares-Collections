<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Honor Firmwares Collections — 文件浏览器</title>
  <style>
    /* 轻量化样式，仿照截图布局 */
    :root{--bg:#ffffff;--muted:#9aa0a6;--accent:#3b82f6;--row:#fbfdff}
    html,body{height:100%;margin:0;font-family:Inter, "Helvetica Neue", Arial, sans-serif;background:var(--bg);color:#1f2937}
    .container{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:18px;margin:0}
    .search{display:flex;gap:8px;align-items:center}
    input[type=search]{padding:8px 12px;border-radius:8px;border:1px solid #e6e9ee;width:320px}
    .breadcrumb{color:var(--muted);font-size:13px;margin-bottom:8px}

    .table{border-radius:10px;overflow:hidden;border:1px solid #eef2f7}
    .table .thead{display:grid;grid-template-columns:40px 1fr 160px 100px;padding:12px 14px;background:#fff}
    .thead .col-title{font-weight:600;color:#374151}
    .thead .col-muted{color:var(--muted);font-weight:500}

    .list{background:var(--row)}
    .row{display:grid;grid-template-columns:40px 1fr 160px 100px;padding:12px 14px;align-items:center;border-top:1px solid rgba(15,23,42,0.02)}
    .row:hover{background:#f7fbff}
    .name{display:flex;gap:10px;align-items:center}
    .name .icon{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;border-radius:6px}
    .name a{color:#0f172a;text-decoration:none;font-weight:500}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:12px;color:var(--muted)}

    .controls{display:flex;gap:8px;align-items:center}
    button{border:0;padding:8px 10px;border-radius:8px;background:#f1f5f9;cursor:pointer}
    .btn-primary{background:var(--accent);color:#fff}

    .empty{padding:36px;text-align:center;color:var(--muted)}

    /* breadcrumbs */
    .crumbs{display:flex;gap:8px;align-items:center;font-size:13px}
    .crumbs a{color:var(--accent);text-decoration:none}

    /* responsive */
    @media(max-width:720px){.container{padding:12px}.thead{display:none}.row{grid-template-columns:1fr}.row .meta{margin-top:6px;display:flex;justify-content:space-between}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Honor Firmwares Collections</h1>
        <div class="breadcrumb" id="breadcrumb">全部文件 &gt; 12.1 &gt; 12.1.1</div>
      </div>
      <div class="search">
        <input id="q" type="search" placeholder="搜索文件或文件夹（按回车）" />
        <div class="controls">
          <button id="refresh">刷新</button>
          <button id="home">回到根目录</button>
        </div>
      </div>
    </header>

    <div class="table" role="table" aria-label="文件表">
      <div class="thead">
        <div></div>
        <div class="col-title">文件名称</div>
        <div class="col-title">修改时间</div>
        <div class="col-title">大小</div>
      </div>
      <div class="list" id="list"></div>
    </div>

    <div id="empty" class="empty" style="display:none">此目录为空</div>

    <footer style="margin-top:18px;color:var(--muted);font-size:13px">提示：在仓库根目录放置 <code>files.json</code> 即可管理条目。编辑该 JSON 文件（GitHub 网页编辑或 pull request）可以方便地更新条目与外链。</footer>
  </div>

  <script>
  // 单文件静态应用：读取根目录 files.json
  // files.json 格式请参照示例（见 README 或聊天）

  const listEl = document.getElementById('list');
  const breadcrumbEl = document.getElementById('breadcrumb');
  const emptyEl = document.getElementById('empty');
  const qEl = document.getElementById('q');

  let FILES_DATA = null;
  let pathStack = []; // array of folder names

  async function loadData(){
    try{
      const res = await fetch('./files.json', {cache: 'no-store'});
      if(!res.ok) throw new Error('files.json 未找到');
      FILES_DATA = await res.json();
      renderCurrent();
    }catch(e){
      listEl.innerHTML = `<div style="padding:20px;color:#b91c1c">无法加载 files.json：${e.message}</div>`;
    }
  }

  function getNodeAtPath(stack){
    let node = {type:'folder', children: FILES_DATA};
    for(const p of stack){
      if(!node.children) return null;
      node = node.children.find(it => it.type==='folder' && it.name===p);
      if(!node) return null;
    }
    return node;
  }

  function fmtSize(s){
    if(!s && s!==0) return '';
    const n = Number(s);
    if(isNaN(n)) return s;
    if(n>=1e9) return (n/1e9).toFixed(2)+' GB';
    if(n>=1e6) return (n/1e6).toFixed(2)+' MB';
    if(n>=1e3) return (n/1e3).toFixed(2)+' KB';
    return n+' B';
  }

  function renderBreadcrumb(){
    if(pathStack.length===0){
      breadcrumbEl.textContent = '全部文件';
      return;
    }
    const crumbs = ['全部文件', ...pathStack];
    breadcrumbEl.innerHTML = crumbs.map((c,i)=> i===crumbs.length-1 ? `<span>${c}</span>` : `<a href="#" data-i="${i}" class="bc">${c}</a>`).join(' &gt; ');
    document.querySelectorAll('.bc').forEach(a=> a.addEventListener('click', (e)=>{
      e.preventDefault();
      const idx = Number(a.dataset.i);
      pathStack = pathStack.slice(0, idx);
      renderCurrent();
    }));
  }

  function renderCurrent(){
    renderBreadcrumb();
    const node = getNodeAtPath(pathStack);
    if(!node){ listEl.innerHTML = '<div style="padding:20px;color:#b91c1c">找不到该目录</div>'; return; }
    const children = Array.isArray(node.children) ? node.children : [];
    // 支持搜索
    const q = (qEl.value || '').trim().toLowerCase();
    const visible = children.filter(it => !q || it.name.toLowerCase().includes(q));

    if(visible.length===0){ listEl.innerHTML=''; emptyEl.style.display='block'; return; } else emptyEl.style.display='none';

    // 把文件夹放前面
    visible.sort((a,b)=>{
      if(a.type===b.type) return a.name.localeCompare(b.name, 'zh');
      return a.type==='folder'? -1:1;
    });

    listEl.innerHTML = visible.map(it=>{
      const icon = it.type==='folder' ? 'folder' : 'file';
      const mtime = it.mtime || '';
      const size = it.type==='file' ? fmtSize(it.size) : '';
      const nameHtml = it.type==='folder'
        ? `<button class="open-folder" data-name="${escapeHtml(it.name)}">${escapeHtml(it.name)}</button>`
        : `<a href="${escapeHtml(it.link||'#')}" data-link="${escapeHtml(it.link||'')}" ${it.link? 'target="_blank" rel="noopener"':''}>${escapeHtml(it.name)}</a>`;

      return `<div class="row" data-type="${icon}">
        <div><div class="icon">${iconSvg(icon)}</div></div>
        <div class="name">${nameHtml}</div>
        <div class="muted">${mtime}</div>
        <div class="small">${size}</div>
      </div>`;
    }).join('');

    // attach folder click handlers
    document.querySelectorAll('.open-folder').forEach(btn=> btn.addEventListener('click', (e)=>{
      const nm = btn.dataset.name;
      pathStack.push(nm);
      renderCurrent();
    }));

    // attach file click handlers (optional: capture links without target)
    document.querySelectorAll('.row a').forEach(a=>{
      a.addEventListener('click', (e)=>{
        // allow default navigation to custom link — no extra action required
        // if you want to track clicks, do it here
      })
    });
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }

  function iconSvg(which){
    if(which==='folder') return `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" fill="#E0F2FE"/><path d="M3 7a2 2 0 012-2h4l2 2h8a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2V7z" stroke="#7dd3fc" stroke-width="0.5" fill-opacity="0"/></svg>`;
    return `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect x="3" y="5" width="18" height="14" rx="2" fill="#F1F5F9" stroke="#cbd5e1"/></svg>`;
  }

  document.getElementById('refresh').addEventListener('click', ()=> loadData());
  document.getElementById('home').addEventListener('click', ()=>{ pathStack = []; renderCurrent(); });
  qEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') renderCurrent(); });

  // 初始加载
  loadData();
  </script>
</body>
</html>
